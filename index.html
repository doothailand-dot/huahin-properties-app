<!DOCTYPE html>
<html>
<head>
  <base target="_top"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root { 
      --primary-green: #24d366; 
      --bg-sale: #e8f5e9; --txt-sale: #2e7d32;
      --bg-rent: #ffebee; --txt-rent: #c62828;
      --bg-both: #e3f2fd; --txt-both: #1565c0;
      --bg-Available: #e8f5e9; --txt-Available: #2e7d32;
    }
    body { font-family: 'Kanit', sans-serif; background-color: #f4f4f4; margin: 0; padding: 0; font-weight: 300; }
    
    /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 6 ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå */
    .filter-panel { background-color: var(--primary-green); color: white; padding: 10px 12px 15px; border-radius: 0 0 20px 20px; position: sticky; top: 0; z-index: 1100; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .filter-row { display: flex; gap: 6px; margin-bottom: 8px; overflow-x: auto; align-items: center; }
    .filter-row::-webkit-scrollbar { display: none; }
    
    .search-input { flex: 1; padding: 6px 12px; border-radius: 50px; border: none; font-size: 12px; outline: none; font-family: 'Kanit'; }
    .chip { background: rgba(255,255,255,0.15); padding: 4px 10px; border-radius: 50px; font-size: 10.5px; white-space: nowrap; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); transition: 0.2s; }
    .chip.active { background: white; color: var(--primary-green); font-weight: 400; border-color: white; }

    .container { padding: 6px; max-width: 450px; margin: 0 auto 75px; }
    
    /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö Compact ‡πÇ‡∏ä‡∏ß‡πå‡πÑ‡∏î‡πâ 6 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
    .compact-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 10px; background: #fff; border-bottom: 1px solid #f0f0f0; }
    .compact-thumb { width: 45px; height: 45px; border-radius: 6px; object-fit: cover; margin-right: 10px; border: 1px solid #eee; }
    .compact-info b { font-size: 12px; color: #333; display: block; font-weight: 400; line-height: 1.1; }
    .compact-info small { font-size: 10px; color: #888; font-weight: 300; display: block; line-height: 1.2; }
    .compact-right { text-align: right; }
    .price-text { color: #333; font-weight: 400; font-size: 12px; }

    .status-pill { font-size: 7px; padding: 1px 5px; border-radius: 50px; font-weight: 400; display: inline-block; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; z-index: 1000; height: 55px; }
    .nav-item { flex: 1; padding: 6px 0; text-align: center; font-size: 9px; color: #999; cursor: pointer; }
    .nav-item.active { color: var(--primary-green); font-weight: 400; }
    .nav-item i { font-size: 16px; margin-bottom: 1px; display: block; }
  </style>
</head>
<body onload="initApp()">

  <div id="filterHeader" class="filter-panel" style="display:none;">
    <div class="filter-row">
      <input type="text" id="searchId" class="search-input" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå..." oninput="applyFilters()">
      <div class="chip active" onclick="setFilter('for', 'All', this)">All</div>
      <div class="chip" onclick="setFilter('for', 'sale', this)">Sale</div>
      <div class="chip" onclick="setFilter('for', 'rent', this)">Rent</div>
    </div>
    <div class="filter-row">
      <div class="chip active" onclick="setFilter('loc', 'All', this)">‡∏ó‡∏∏‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</div>
      <div class="chip" onclick="setFilter('loc', 'Hua Hin', this)">‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô</div>
      <div class="chip" onclick="setFilter('loc', 'Chaam', this)">‡∏ä‡∏∞‡∏≠‡∏≥</div>
      <div class="chip" onclick="setFilter('loc', 'Pranburi', this)">‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ</div>
    </div>
    <div class="filter-row" style="margin-bottom:0;">
      <div class="chip active" onclick="setFilter('type', 'All', this)">üè† ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</div>
      <div class="chip" onclick="setFilter('type', 'house', this)">‡∏ö‡πâ‡∏≤‡∏ô</div>
      <div class="chip" onclick="setFilter('type', 'condo', this)">‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î</div>
      <div class="chip active" onclick="setFilter('bed', 'All', this)">üõèÔ∏è ‡∏ô‡∏≠‡∏ô</div>
      <div class="chip" onclick="setFilter('bed', '2', this)">2</div>
      <div class="chip" onclick="setFilter('bed', '3', this)">3</div>
      <div class="chip active" onclick="setFilter('price', 'All', this)">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤</div>
      <div class="chip" onclick="setFilter('price', 'under3', this)">< 3M</div>
      <div class="chip" onclick="setFilter('price', '3to7', this)">3-7M</div>
    </div>
  </div>

  <div class="container">
    <div id="propertiesPage" style="display:none;"><div id="propertiesList"></div></div>
    <div id="visitPage" style="display:none; text-align:center; padding-top:100px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
    <div id="loginPage" style="display:none; padding:20px;"><button class="menu-btn" onclick="handleLogin()">Login</button></div>
  </div>

  <div id="bottomNav" class="bottom-nav" style="display:none;"><div class="nav-item" id="btnStock" onclick="openProperties()"><i class="fa-solid fa-house"></i><div>‡∏™‡∏ï‡πá‡∏≠‡∏Å</div></div><div class="nav-item" id="btnAppoint" onclick="switchPage('visitPage')"><i class="fa-solid fa-calendar-check"></i><div>‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</div></div><div class="nav-item active" id="btnCheckin" onclick="showVisitPage()"><i class="fa-solid fa-file-signature"></i><div>‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</div></div><div class="nav-item" id="btnLogout" onclick="handleLogout()"><i class="fa-solid fa-sign-out-alt"></i><div>‡∏≠‡∏≠‡∏Å</div></div></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyLB6o3Nqm8QtYSkneLHDva0T8hxkLHVl5iu1EM2IrswK8uyPkGQ4VlvP77nXHIBMB7KA/exec"; 
    let allHouses = [], currentFilters = { for: 'All', loc: 'All', type: 'All', bed: 'All', price: 'All' };

    async function initApp() {
      const ph = localStorage.getItem('agent_phone'), ps = localStorage.getItem('agent_pass');
      if (ph && ps) {
        const res = await fetch(`${API_URL}?action=login&phone=${ph}&password=${ps}`).then(r => r.json());
        if (res?.success) { globalProfile = res.profile; openProperties(); } 
        else switchPage('loginPage');
      } else switchPage('loginPage');
    }

    function switchPage(id) {
      ['loginPage', 'visitPage', 'propertiesPage'].forEach(p => { const el = document.getElementById(p); if(el) el.style.display = 'none'; });
      document.getElementById(id).style.display = 'block';
      document.getElementById('filterHeader').style.display = (id === 'propertiesPage') ? 'block' : 'none';
      document.getElementById('bottomNav').style.display = (id === 'loginPage') ? 'none' : 'flex';
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      if(id === 'propertiesPage') document.getElementById('btnStock').classList.add('active');
    }

    async function openProperties() {
      switchPage('propertiesPage');
      if(allHouses.length === 0) {
          document.getElementById('propertiesList').innerHTML = '<div style="text-align:center; padding:20px; font-size:11px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
          const res = await fetch(`${API_URL}?action=getProperties`).then(r => r.json());
          allHouses = res.data;
      }
      applyFilters();
    }

    function setFilter(key, val, el) {
      currentFilters[key] = val;
      el.parentElement.querySelectorAll('.chip').forEach(s => s.classList.remove('active'));
      el.classList.add('active');
      applyFilters();
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 6 ‡∏°‡∏¥‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
    function applyFilters() {
      const searchId = document.getElementById('searchId').value.toLowerCase();
      const filtered = allHouses.filter(h => {
        const matchId = h.id.toLowerCase().includes(searchId);
        const matchFor = currentFilters.for === 'All' || h.forStatus.toLowerCase() === currentFilters.for;
        const matchLoc = currentFilters.loc === 'All' || h.amphoe.includes(currentFilters.loc);
        const matchType = currentFilters.type === 'All' || h.type.toLowerCase().includes(currentFilters.type);
        const matchBed = currentFilters.bed === 'All' || h.bed.toString() === currentFilters.bed;
        let matchPrice = true;
        const p = Number(h.price.toString().replace(/[^0-9.]/g, ''));
        if(currentFilters.price === 'under3') matchPrice = p < 3000000;
        else if(currentFilters.price === '3to7') matchPrice = p >= 3000000 && p <= 7000000;
        return matchId && matchFor && matchLoc && matchType && matchBed && matchPrice;
      });
      renderList(filtered);
    }

    function renderList(data) {
      const list = document.getElementById('propertiesList');
      list.innerHTML = data.map(h => {
        let displayPrice = Number(h.price.toString().replace(/[^0-9.]/g, '')).toLocaleString();
        return `<div class="compact-item"><div style="display:flex; align-items:center;"><img class="compact-thumb" src="${h.img || 'https://placehold.co/100'}"><div class="compact-info"><b>${h.id} <span style="font-weight:300; font-size:9px;">[${h.type}]</span></b><small>${h.forStatus} | üõèÔ∏è ${h.bed} | <b>${h.amphoe}</b></small></div></div><div class="compact-right"><span class="price-text">‡∏ø ${displayPrice}</span><br><span class="status-pill" style="color:#2e7d32; font-size:8px;">${h.status}</span></div></div>`;
      }).join('');
    }

    async function handleLogin() { location.reload(); }
    function handleLogout() { localStorage.clear(); location.reload(); }
  </script>
</body>
</html>
