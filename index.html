<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUA HIN PROPERTIES - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { background-color: #121212; color: #fff; font-family: 'Kanit', sans-serif; height: 100vh; }
        .login-container { max-width: 400px; margin: 100px auto; padding: 30px; background: #1e1e1e; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
        .property-card { background: #1a1a1a; border-radius: 15px; overflow: hidden; margin-bottom: 20px; border: 1px solid #333; }
        .property-img { height: 200px; object-fit: cover; width: 100%; border-bottom: 3px solid #ffc107; }
        .price { color: #ffc107; font-size: 1.3rem; font-weight: bold; }
        #mainContent { display: none; } /* ซ่อนเนื้อหาไว้จนกว่าจะล็อกอิน */
        .admin-badge { background: #ffc107; color: #000; padding: 2px 10px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

    <div id="loginPage" class="container">
        <div class="login-container text-center">
            <img src="https://cdn-icons-png.flaticon.com/512/607/607614.png" width="80" class="mb-3">
            <h3 class="mb-4">Agent Login</h3>
            <input type="email" id="emailInput" class="form-control mb-3" placeholder="ระบุอีเมลของคุณ" required>
            <button class="btn btn-warning w-100 fw-bold" onclick="handleLogin()">เข้าสู่ระบบ</button>
            <p class="mt-3 text-secondary small">ระบบตรวจพบสิทธิ์แอดมินอัตโนมัติจากอีเมล</p>
        </div>
    </div>

    <div id="mainContent" class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4>รายการอสังหาริมทรัพย์ <span id="adminTag"></span></h4>
            <button class="btn btn-outline-light btn-sm" onclick="location.reload()">ออกจากระบบ</button>
        </div>
        <div id="propertyList" class="row">กำลังดึงข้อมูลล่าสุด...</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // *** 1. วาง URL เว็บแอปของคุณที่นี่ ***
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwSuBmFRK8OKfsBPt_XEeAYHPg2uW_qc1cwh2lIR5yUQB6q5r1VyNnhUqieH_BKRH08qA/exec"; 
        
        // *** 2. ระบุอีเมลแอดมินของคุณ ***
        const ADMIN_EMAIL = "doothailand@gmail.com"; 

        let userEmail = "";

        async function handleLogin() {
            userEmail = document.getElementById('emailInput').value.toLowerCase().trim();
            if (!userEmail) { alert("กรุณากรอกอีเมล"); return; }

            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            if (userEmail === ADMIN_EMAIL.toLowerCase()) {
                document.getElementById('adminTag').innerHTML = '<span class="admin-badge">ADMIN MODE</span>';
            }
            loadProperties();
        }

        async function loadProperties() {
            try {
                const response = await fetch(WEB_APP_URL + "?action=read");
                const data = await response.json();
                let html = '';
                data.forEach(item => {
                    const isAdmin = (userEmail === ADMIN_EMAIL.toLowerCase());
                    html += `
                        <div class="col-md-4">
                            <div class="property-card shadow">
                                <img src="${item.image_url}" class="property-img" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                                <div class="p-3">
                                    <h5 class="text-info">${item.property_id}</h5>
                                    <p class="mb-1">${item.project_name || '-'}</p>
                                    <p class="price">ราคา: ${item.price || '-'}</p>
                                    <hr style="border-color:#333">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-sm btn-outline-info">ดูรายละเอียด</button>
                                        ${isAdmin ? `<a href="${WEB_APP_URL}" target="_blank" class="btn btn-sm btn-warning fw-bold">แก้ไขข้อมูล (ทุกคอลัมน์)</a>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                document.getElementById('propertyList').innerHTML = html;
            } catch (e) {
                document.getElementById('propertyList').innerHTML = '<div class="alert alert-danger">เชื่อมต่อข้อมูลไม่สำเร็จ</div>';
            }
        }
    </script>
</body>
</html>
